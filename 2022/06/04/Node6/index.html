<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>http内置模块，Express和Koa | Cabbage</title>
  <meta name="description" content="http内置模块，Node框架Express和Koahttp模块1234567891011121314151617181920212223242526const http &#x3D; require(&amp;#x27;http&amp;#x27;);&#x2F;&#x2F; 创建一个web服务器const server &#x3D; http.createServer((req, res) &#x3D;&gt; &amp;#123;  res.end(&quot;H">
<meta property="og:type" content="article">
<meta property="og:title" content="http内置模块，Express和Koa">
<meta property="og:url" content="https://222cabbage.github.io/2022/06/04/Node6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="http内置模块，Node框架Express和Koahttp模块1234567891011121314151617181920212223242526const http &#x3D; require(&amp;#x27;http&amp;#x27;);&#x2F;&#x2F; 创建一个web服务器const server &#x3D; http.createServer((req, res) &#x3D;&gt; &amp;#123;  res.end(&quot;H">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2022/09/22/xFpDo9.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/09/22/xFY0mT.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/09/22/xFYytJ.png">
<meta property="article:published_time" content="2022-06-03T17:47:14.000Z">
<meta property="article:modified_time" content="2022-09-22T18:20:52.682Z">
<meta property="article:author" content="不知名小白菜">
<meta property="article:tag" content="Node学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/09/22/xFpDo9.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://222cabbage.github.io/2022/06/04/Node6/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 6.1.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/222cabbage" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">222cabbage</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">我是小白菜</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Chongqing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/222cabbage" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎来到小白菜的博客!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HaoUI/">HaoUI</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebGIS/">WebGIS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Webpack/">Webpack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/promise/">promise</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/typescript/">typescript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/utils/">utils</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vite/">vite</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue3/">vue3</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81/">vue框架源码</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/webGL/">webGL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/websocket/">websocket</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93mysql%E7%9A%84%E5%AD%A6%E4%B9%A0/">数据库mysql的学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/">组件封装</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS%E6%96%B9%E6%B3%95%E6%8A%80%E5%B7%A7/" rel="tag">JS方法技巧</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node%E5%AD%A6%E4%B9%A0/" rel="tag">Node学习</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue2%E6%BA%90%E7%A0%81/" rel="tag">Vue2源码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebGIS/" rel="tag">WebGIS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack%E5%AD%A6%E4%B9%A0/" rel="tag">Webpack学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/promise/" rel="tag">promise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ts/" rel="tag">ts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vite/" rel="tag">vite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webGL/" rel="tag">webGL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA%E7%BB%84%E4%BB%B6%E5%BA%93/" rel="tag">个人组件库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">微信小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" rel="tag">数据结构与算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%951/" rel="tag">数据结构与算法1</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/" rel="tag">组件封装</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Go/" style="font-size: 13px;">Go</a> <a href="/tags/JS%E6%96%B9%E6%B3%95%E6%8A%80%E5%B7%A7/" style="font-size: 13px;">JS方法技巧</a> <a href="/tags/Node%E5%AD%A6%E4%B9%A0/" style="font-size: 14px;">Node学习</a> <a href="/tags/React/" style="font-size: 13px;">React</a> <a href="/tags/Vue2%E6%BA%90%E7%A0%81/" style="font-size: 13px;">Vue2源码</a> <a href="/tags/WebGIS/" style="font-size: 13px;">WebGIS</a> <a href="/tags/Webpack%E5%AD%A6%E4%B9%A0/" style="font-size: 13px;">Webpack学习</a> <a href="/tags/mysql/" style="font-size: 13px;">mysql</a> <a href="/tags/promise/" style="font-size: 13px;">promise</a> <a href="/tags/ts/" style="font-size: 13px;">ts</a> <a href="/tags/vite/" style="font-size: 13px;">vite</a> <a href="/tags/vue/" style="font-size: 13px;">vue</a> <a href="/tags/vue3/" style="font-size: 13.5px;">vue3</a> <a href="/tags/webGL/" style="font-size: 13px;">webGL</a> <a href="/tags/websocket/" style="font-size: 13px;">websocket</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E7%BB%84%E4%BB%B6%E5%BA%93/" style="font-size: 13.5px;">个人组件库</a> <a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 13px;">微信小程序</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 13px;">数据结构与算法</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%951/" style="font-size: 13px;">数据结构与算法1</a> <a href="/tags/%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/" style="font-size: 13px;">组件封装</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 13.5px;">面试题</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">12</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Go/">Go</a>
              </p>
              <p class="item-title">
                <a href="/2022/09/27/go1/" class="title">学一下Go</a>
              </p>
              <p class="item-date">
                <time datetime="2022-09-27T15:41:02.000Z" itemprop="datePublished">2022-09-27</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/vue3/">vue3</a>
              </p>
              <p class="item-title">
                <a href="/2022/09/24/vue32/" class="title">vue3的优化</a>
              </p>
              <p class="item-date">
                <time datetime="2022-09-24T05:02:16.000Z" itemprop="datePublished">2022-09-24</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/WebGIS/">WebGIS</a>
              </p>
              <p class="item-title">
                <a href="/2022/09/23/webgis1/" class="title">看看WebGIS，极简单的智慧校园小demo</a>
              </p>
              <p class="item-date">
                <time datetime="2022-09-22T18:30:26.000Z" itemprop="datePublished">2022-09-23</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a>
              </p>
              <p class="item-title">
                <a href="/2022/09/14/miniweixin/" class="title">跟着官网过过微信小程序</a>
              </p>
              <p class="item-date">
                <time datetime="2022-09-14T05:01:21.000Z" itemprop="datePublished">2022-09-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/vue/">vue</a>
              </p>
              <p class="item-title">
                <a href="/2022/09/06/vuerouterandvuex/" class="title">实现一个vue-router</a>
              </p>
              <p class="item-date">
                <time datetime="2022-09-06T08:15:58.000Z" itemprop="datePublished">2022-09-06</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  <main class="main" role="main">
  <div class="content">
  <article id="post-Node6" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      http内置模块，Express和Koa
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/06/04/Node6/" class="article-date">
	  <time datetime="2022-06-03T17:47:14.000Z" itemprop="datePublished">2022-06-04</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Node/">Node</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/Node%E5%AD%A6%E4%B9%A0/" rel="tag">Node学习</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/06/04/Node6/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="http内置模块，Node框架Express和Koa"><a href="#http内置模块，Node框架Express和Koa" class="headerlink" title="http内置模块，Node框架Express和Koa"></a>http内置模块，Node框架Express和Koa</h2><h3 id="http模块"><a href="#http模块" class="headerlink" title="http模块"></a>http模块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);</span><br><span class="line"></span><br><span class="line">// 创建一个web服务器</span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  res.end(&quot;Hello Server&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 启动服务器,并且制定端口号和主机</span><br><span class="line">server.listen(8888, &#x27;0.0.0.0&#x27;, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">如果没有输入端口号，可以通过server.address().port获取</span><br><span class="line">server.listen(() =&gt; &#123;</span><br><span class="line">  console.log(&quot;服务器启动成功~&quot;);</span><br><span class="line">  console.log(server.address().port)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">listen函数有三个参数</span><br><span class="line">端口port，可以不穿，系统默认分配</span><br><span class="line">主机host，通常是localhost，ip127.0.0.1，或者0.0.0.0，默认是0.0.0.0</span><br><span class="line">localhost本质上是一个域名会被解析成127.0.0.1</span><br><span class="line">127.0.0.1是回环地址，自己主机发出去的包自己解析，在应用层 =&gt; 传输层 =&gt; 网络层 =&gt; 链路层 =&gt; 物理层</span><br><span class="line">在网络层就会被获取，不会经过链路层是物理层</span><br><span class="line">0.0.0.0监听所有IP地址，再根据端口找到不同的应用程序</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="req"><a href="#req" class="headerlink" title="req"></a>req</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">request包含请求路径，方法和头等</span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">	console.log(requrl)</span><br><span class="line">	console.log(req.ethod)</span><br><span class="line">	console.log(req.eaders)</span><br><span class="line">  res.end(&quot;Hello Server&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">url</span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">   if(req.url== &#x27;/login&#x27;)</span><br><span class="line">        res.end(&quot;请登录&quot;)</span><br><span class="line">   &#125;else if(req.url==&#x27;/register&#x27;)&#123;</span><br><span class="line">		res.end(&quot;请注册&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">如果访问地址携带参数，利用url模块和qs模块，明文传输方式</span><br><span class="line">const url = require(&#x27;url&#x27;）</span><br><span class="line">const qs = require(&#x27;querystring&#x27;);</span><br><span class="line">  const &#123; pathname, query &#125; = url.parse(req.url);</span><br><span class="line">  if (pathname === &#x27;/login&#x27;) &#123;</span><br><span class="line">    console.log(qs.parse(query));</span><br><span class="line">    const &#123; username, password &#125; = qs.parse(query);</span><br><span class="line">    console.log(username, password);</span><br><span class="line">    res.end(&quot;请求结果~&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">method</span><br><span class="line">拿到通过post请求发送的json数据，不在地址栏</span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  console.log(req.method)</span><br><span class="line">     if(req.methdos == &#x27;POST&#x27;)&#123;</span><br><span class="line">		//获取body数据</span><br><span class="line">		req.setEncoding(&#x27;utf-8&#x27;) //设置数据编码 如果是音频和其他文件就是其他编码</span><br><span class="line">		req.on(&#x27;data&#x27;,(data)=&gt;&#123;</span><br><span class="line">            console.log(data.toString()) //字符串类型 &#123;username:&quot;&#x27;,age:&quot;&#x27;&#125;</span><br><span class="line">            转换成js对象</span><br><span class="line">            const &#123; username, age &#125; = JSON.parse(data.toString())</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">headers</span><br><span class="line">console.log(req.headers)</span><br><span class="line">contenttype：数据类型</span><br><span class="line">content-length：文件长度</span><br><span class="line">connection：keep-alive保持连接</span><br><span class="line">accept-encoding：告知服务器，客户端支持的文件压缩格式，比如js文件可以使用gzip编码。对应.gz文件</span><br><span class="line">accept：告知服务器科技接收的文件格式</span><br><span class="line">user-agent：客户端相关信息</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="res"><a href="#res" class="headerlink" title="res"></a>res</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">response</span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  	1：res.end(&quot;响应结果&quot;)</span><br><span class="line">  	2：res.write(&quot;响应结果&quot;)</span><br><span class="line">  	   res.end()</span><br><span class="line">  	</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">响应状态码</span><br><span class="line">1：需要后续操作</span><br><span class="line">2：OK，成功</span><br><span class="line">3：重定向</span><br><span class="line">4：客户端</span><br><span class="line">5：服务端</span><br><span class="line"></span><br><span class="line">状态码设置方式</span><br><span class="line">res.statusCode = 404</span><br><span class="line">res.writeHead(404,&#123;</span><br><span class="line">    可以传入header相关的事情</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">设置头方式</span><br><span class="line">1：res.setHeader(&quot;content-type&quot;, &quot;text/plain&quot;)</span><br><span class="line">2：res.writeHead(200, &#123;</span><br><span class="line">    &quot;content-type&quot;:&quot;text/plain&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="http发送网络请求"><a href="#http发送网络请求" class="headerlink" title="http发送网络请求"></a>http发送网络请求</h4><p>axios在前端使用时，基于xhr，在node端使用时是基于http模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;)</span><br><span class="line">http.get(&#x27;...&#x27;,(res)=&gt;&#123;</span><br><span class="line">    res.on(&#x27;data&#x27;,(data)+&gt;&#123;</span><br><span class="line">        console.log(data) //结果</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">发送post</span><br><span class="line">const req = http.request(&#123;</span><br><span class="line">    method:&#x27;POST&#x27;,</span><br><span class="line">    host:&#x27;localhost&#x27;,</span><br><span class="line">    port:8888</span><br><span class="line">&#125;,(res)=&gt;&#123;</span><br><span class="line">    res.on(&#x27;data&#x27;,(data)=&gt;&#123;</span><br><span class="line">        console.log(&#x27;结果&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    res.on(&#x27;end&#x27;,()=&gt;&#123;</span><br><span class="line">		console.log(&#x27;获取到了所有结果&#x27;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.end() //必须，否则请求停滞</span><br></pre></td></tr></table></figure>

<h4 id="http方式原生的文件上传"><a href="#http方式原生的文件上传" class="headerlink" title="http方式原生的文件上传"></a>http方式原生的文件上传</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);</span><br><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const qs = require(&#x27;querystring&#x27;);</span><br><span class="line"></span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  if (req.url === &#x27;/upload&#x27;) &#123;</span><br><span class="line">    if (req.method === &#x27;POST&#x27;) &#123;</span><br><span class="line">    	//必须，图片编码必须设置为binary</span><br><span class="line">      req.setEncoding(&#x27;binary&#x27;);</span><br><span class="line"></span><br><span class="line">      let body = &#x27;&#x27;;</span><br><span class="line">      const totalBoundary = req.headers[&#x27;content-type&#x27;].split(&#x27;;&#x27;)[1];</span><br><span class="line">      const boundary = totalBoundary.split(&#x27;=&#x27;)[1];</span><br><span class="line"></span><br><span class="line">      req.on(&#x27;data&#x27;, (data) =&gt; &#123;</span><br><span class="line">        body += data;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      req.on(&#x27;end&#x27;, () =&gt; &#123;</span><br><span class="line">        console.log(body);</span><br><span class="line">        // 处理body</span><br><span class="line">        // 1.获取image/png的位置</span><br><span class="line">        const payload = qs.parse(body, &quot;\r\n&quot;, &quot;: &quot;);</span><br><span class="line">        const type = payload[&quot;Content-Type&quot;];</span><br><span class="line"></span><br><span class="line">        // 2.开始在image/png的位置进行截取</span><br><span class="line">        const typeIndex = body.indexOf(type);</span><br><span class="line">        const typeLength = type.length;</span><br><span class="line">        let imageData = body.substring(typeIndex + typeLength);</span><br><span class="line"></span><br><span class="line">        // 3.将中间的两个空格去掉</span><br><span class="line">        imageData = imageData.replace(/^\s\s*/, &#x27;&#x27;);</span><br><span class="line"></span><br><span class="line">        // 4.将最后的boundary去掉</span><br><span class="line">        imageData = imageData.substring(0, imageData.indexOf(`--$&#123;boundary&#125;--`));</span><br><span class="line"></span><br><span class="line">        fs.writeFile(&#x27;./foo.png&#x27;, imageData, &#x27;binary&#x27;, (err) =&gt; &#123;</span><br><span class="line">          res.end(&quot;文件上传成功~&quot;);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;文件上传服务器开启成功~&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h3><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//安装方式 1 脚手架安装</span><br><span class="line">npm install express-generator -g</span><br><span class="line">expres  demo</span><br><span class="line">npm install</span><br><span class="line">node bin/www</span><br><span class="line">// 默认启动是loaclhost:3000</span><br><span class="line"></span><br><span class="line">// 2自己从0实现</span><br><span class="line"> npm install express</span><br><span class="line">// 引入</span><br><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">// 返回app</span><br><span class="line">const app = express()</span><br><span class="line">//监听请求路径</span><br><span class="line">app.get(&#x27;/&#x27;,(req,res,next)=&gt;&#123;</span><br><span class="line">    res.end(&#x27;hello get&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line">app.post(&#x27;/&#x27;,(req,res,next)=&gt;&#123;</span><br><span class="line">    res.end(&#x27;hello post&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(5000,()=&gt;&#123;</span><br><span class="line">    console.log(&#x27;开启&#x27;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>express的中间件，中间件就是回调函数，接受req，res，next，next是执行下一个中间件的方法，express本质上是中间件的调用</p>
<p>中间件中可以执行任何代码，更改请求和响应对象，结束请求，响应周期，返回数据，调用栈中的下一个中间件</p>
<p>如果没有res.end就需要next传递给下一个中间件，否则请求会被挂起，不会结束</p>
<p>express提供了两种方式将中间件应用与程序中，app&#x2F;router.use和app&#x2F;router.methods</p>
<p>可以是app，也可以是router，methods是指常用的请求方式app.get或者app.post</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">中间件类型1//最普通的中间件</span><br><span class="line">app.use((req,res,next)=&gt;&#123;</span><br><span class="line">    console.log(&#x27;注册了第一个普通中间件&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line">只会执行一个中间件</span><br><span class="line">app.use((req,res,next)=&gt;&#123;</span><br><span class="line">    console.log(&#x27;注册了第一个普通中间件&#x27;)</span><br><span class="line">    res.end()</span><br><span class="line">    // 想要让第二个中间件执行得</span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use((req,res,next)=&gt;&#123;</span><br><span class="line">    console.log(&#x27;注册了第二个普通中间件&#x27;)</span><br><span class="line">    res.end() // 报错 不能在end之后再end，end只能有一个</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">中间件类型2//path匹配中间件</span><br><span class="line">app.use(path,callback)</span><br><span class="line">app.use(&#x27;/home&#x27;,(req,res,next)=&gt;&#123;</span><br><span class="line">    console.log(&#x27;匹配到了/home&#x27;)</span><br><span class="line">    res.end(&#x27;end&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">如果有相同的path匹配中间件，永远只会调用第一个中间件，除非使用next</span><br><span class="line"></span><br><span class="line">中间件类型3//path和method匹配中间件</span><br><span class="line">app.get(&#x27;/home&#x27;,(req.res,next)=&gt;&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">中间件类型4//注册多个中间件</span><br><span class="line">app.get(&#x27;/home&#x27;,(req,res,next)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;,(req,res,next)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;,(req,res,next)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//使用express解析req.body很轻松  解析json</span><br><span class="line">app.use(express.json())</span><br><span class="line"></span><br><span class="line">// true是使用qs解析，false那么就是使用node中的queryString进行解析 解析urlencoded</span><br><span class="line">app.use(express.urlencoded(&#123;extended:true&#125;))</span><br><span class="line"></span><br><span class="line">// 解析formdata</span><br><span class="line">npm install multer</span><br><span class="line">const upload = require(&#x27;multer&#x27;)</span><br><span class="line">app.use(multer.any())</span><br><span class="line">// 上穿文件 设置上传路径</span><br><span class="line">const multer = multer(&#123;</span><br><span class="line">    dest:&#x27;./uploads/&#x27; // 上传文件保存位置,</span><br><span class="line">&#125;)</span><br><span class="line">const path = require(&#x27;path&#x27;</span><br><span class="line">const storage = muliter.diskStorge(&#123;</span><br><span class="line">    destintion: (req,res,cb)=&gt;&#123;</span><br><span class="line">        cb(null,&#x27;./uploads/&#x27;)</span><br><span class="line">    &#125;//目的地，</span><br><span class="line">    filename: (req,res,cb)=&gt;&#123;</span><br><span class="line">        cb(null, Date.now() + path.extname(file.originalname))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">upload.single 上传单个文件 upload.array 上传多个文件 可以传递一个key值表示具体处理哪个数据</span><br><span class="line">app.post(&#x27;/upload&#x27;,upload.single(&#x27;&#x27;) ,(req,res,next)=&gt;&#123;</span><br><span class="line">	console.log(req.files)</span><br><span class="line">    res.end(&#x27;上传成功&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line">// 默认没有后缀名</span><br></pre></td></tr></table></figure>

<h4 id="中间件用法"><a href="#中间件用法" class="headerlink" title="中间件用法"></a>中间件用法</h4><h4 id="json解析"><a href="#json解析" class="headerlink" title="json解析"></a>json解析</h4><p>express内置一些request解析的中间件 ，当客户端发送请求post请求时，会把数据放到req.body中</p>
<p>客户端可以通过json也可以通过form表单的方式传递</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">post 发送username和age</span><br><span class="line"></span><br><span class="line">自己写的</span><br><span class="line">// app.use((req, res, next) =&gt; &#123;</span><br><span class="line">//   if (req.headers[&quot;content-type&quot;] === &#x27;application/json&#x27;) &#123;</span><br><span class="line">//     req.on(&#x27;data&#x27;, (data) =&gt; &#123;</span><br><span class="line">//       const info = JSON.parse(data.toString());</span><br><span class="line">//       req.body = info;</span><br><span class="line">//     &#125;)</span><br><span class="line">  </span><br><span class="line">//     req.on(&#x27;end&#x27;, () =&gt; &#123;</span><br><span class="line">//       next();</span><br><span class="line">//     &#125;)</span><br><span class="line">//   &#125; else &#123;</span><br><span class="line">//     next();</span><br><span class="line">//   &#125;</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line">使用express</span><br><span class="line">// 使用express提供给我们的body解析</span><br><span class="line">// body-parser: express3.x 内置express框架</span><br><span class="line">// body-parser: express4.x 被分离出去</span><br><span class="line">// body-parser类似功能: express4.16.x 内置成函数</span><br><span class="line">app.use(express.json()); //传送数据为json格式时 application/json</span><br><span class="line">// extended</span><br><span class="line">// true: 那么对urlencoded进行解析时, 它使用的是第三方库: qs</span><br><span class="line">// false: 那么对urlencoded进行解析时, 它使用的是Node内置模块: querystring</span><br><span class="line">app.use(express.urlencoded(&#123;extended: true&#125;));//传送数据解析application/x-www-form-urlencoded</span><br><span class="line">后续可直接通过打印req.body方式获取传送数据</span><br><span class="line">app.post(&#x27;/login&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.body);</span><br><span class="line">  res.end(&quot;Coderwhy, Welcome Back~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(&#x27;/products&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.body);</span><br><span class="line">  res.end(&quot;Upload Product Info Success~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;express初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="formdata解析"><a href="#formdata解析" class="headerlink" title="formdata解析"></a>formdata解析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">npm install multer</span><br><span class="line"></span><br><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const multer = require(&#x27;multer&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line">app.use(express.urlencoded(&#123; extended: true &#125;));</span><br><span class="line"></span><br><span class="line">const upload = multer();</span><br><span class="line"></span><br><span class="line">app.use(upload.any());</span><br><span class="line"></span><br><span class="line">app.post(&#x27;/login&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.body);</span><br><span class="line">  res.end(&quot;用户登录成功~&quot;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;form-data解析服务器启动成功~&quot;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="formdata上传文件"><a href="#formdata上传文件" class="headerlink" title="formdata上传文件"></a>formdata上传文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&#x27;path&#x27;);</span><br><span class="line"></span><br><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const multer = require(&#x27;multer&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line">app.use(express.urlencoded(&#123; extended: true &#125;));</span><br><span class="line"></span><br><span class="line">//自定义的文件信息</span><br><span class="line">const storage = multer.diskStorage(&#123;</span><br><span class="line">  destination: (req, file, cb) =&gt; &#123;</span><br><span class="line">    cb(null, &#x27;./uploads/&#x27;);</span><br><span class="line">  &#125;,</span><br><span class="line">  filename: (req, file, cb) =&gt; &#123;</span><br><span class="line">    cb(null, Date.now() + path.extname(file.originalname));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const upload = multer(&#123;</span><br><span class="line">  // dest: &#x27;./uploads/&#x27; //文件存储路径</span><br><span class="line">  storage //自定义文件存储信息</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(&#x27;/login&#x27;, upload.any(), (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.body);</span><br><span class="line">  res.end(&quot;用户登录成功~&quot;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">上传单个文件</span><br><span class="line">app.post(&#x27;/upload&#x27;, upload.single(&#x27;file&#x27;), (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.files);</span><br><span class="line">  res.end(&quot;文件上传成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">上传多个文件</span><br><span class="line">app.post(&#x27;/upload&#x27;, upload.array(&#x27;file&#x27;), (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.files);</span><br><span class="line">  res.end(&quot;文件上传成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;form-data解析服务器启动成功~&quot;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="保存日志信息"><a href="#保存日志信息" class="headerlink" title="保存日志信息"></a>保存日志信息</h4><p>使用express开发的第三方中间件，morgan，需要单独安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line"></span><br><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const morgan = require(&#x27;morgan&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">const writerStream = fs.createWriteStream(&#x27;./logs/access.log&#x27;, &#123;</span><br><span class="line">  flags: &quot;a+&quot;</span><br><span class="line">&#125;)</span><br><span class="line">//combined是保存的日志格式，</span><br><span class="line">app.use(morgan(&quot;combined&quot;, &#123;stream: writerStream&#125;));</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/home&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  res.end(&quot;Hello World&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;express初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="request参数解析"><a href="#request参数解析" class="headerlink" title="request参数解析"></a>request参数解析</h4><p><img src="https://s1.ax1x.com/2022/09/22/xFpDo9.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/products/:id/:name&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.params);</span><br><span class="line">  // req.params =&gt; 在数据库中查询真实的商品数据</span><br><span class="line">  res.end(&quot;商品的详情数据~&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/login&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.query);</span><br><span class="line">  res.end(&quot;用户登录成功~&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;普通中间件服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="response响应结果解析"><a href="#response响应结果解析" class="headerlink" title="response响应结果解析"></a>response响应结果解析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const router = require(&#x27;./routers/users&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/products/:id/:name&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.params);</span><br><span class="line">  // req.params =&gt; 在数据库中查询真实的商品数据</span><br><span class="line">  res.end(&quot;商品的详情数据~&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/login&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  console.log(req.query);</span><br><span class="line"></span><br><span class="line">  // 设置响应吗</span><br><span class="line">  res.status(204);</span><br><span class="line"></span><br><span class="line">  // res.type(&quot;application/json&quot;);</span><br><span class="line">  // res.end(JSON.stringify(&#123;name: &quot;why&quot;, age: 18&#125;));</span><br><span class="line">  // res.json(&#123;name: &quot;why&quot;, age: 18&#125;)</span><br><span class="line">  // 设置内容</span><br><span class="line">  res.json([&quot;abc&quot;, &quot;cba&quot;, &quot;abc&quot;]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 举个例子:</span><br><span class="line"> *   请求所有的用户信息: get /users</span><br><span class="line"> *   请求所有的某个用户信息: get /users/:id</span><br><span class="line"> *   请求所有的某个用户信息: post /users body &#123;username: passwod:&#125;</span><br><span class="line"> *   请求所有的某个用户信息: delete /users/:id </span><br><span class="line"> *   请求所有的某个用户信息: patch /users/:id &#123;nickname: &#125;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;普通中间件服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="路由的使用"><a href="#路由的使用" class="headerlink" title="路由的使用"></a>路由的使用</h4><p>如果将所有代码放在app中，那么app会越来越复杂，可以使用express.Router创建一个路由处理程序，一个路由实例拥有完整的中间件和路由系统，因此也被称为迷你应用程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const userRouter = require(&#x27;./routers/users&#x27;);</span><br><span class="line">const productRouter = require(&#x27;./routers/products&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.use(&quot;/users&quot;, userRouter);</span><br><span class="line">app.use(&quot;/products&quot;, productRouter);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;路由服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">routers/users</span><br><span class="line">/**</span><br><span class="line"> * 举个例子:</span><br><span class="line"> *   请求所有的用户信息: get /users</span><br><span class="line"> *   请求所有的某个用户信息: get /users/:id</span><br><span class="line"> *   请求所有的某个用户信息: post /users body &#123;username: passwod:&#125;</span><br><span class="line"> *   请求所有的某个用户信息: delete /users/:id </span><br><span class="line"> *   请求所有的某个用户信息: patch /users/:id &#123;nickname: &#125;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">const router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  res.json([&quot;why&quot;, &quot;kobe&quot;, &quot;lilei&quot;]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/:id&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  res.json(`$&#123;req.params.id&#125;用户的信息`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  res.json(&quot;create user success~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="静态服务器"><a href="#静态服务器" class="headerlink" title="静态服务器"></a>静态服务器</h4><p>express提供了部署静态资源的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.use(express.static(&#x27;./build&#x27;)); //.build中是打包后的文件 npm run build</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;路由服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="express的错误处理"><a href="#express的错误处理" class="headerlink" title="express的错误处理"></a>express的错误处理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">const USERNAME_DOES_NOT_EXISTS = &quot;USERNAME_DOES_NOT_EXISTS&quot;;</span><br><span class="line">const USERNAME_ALREADY_EXISTS = &quot;USERNAME_ALREADY_EXISTS&quot;;</span><br><span class="line"></span><br><span class="line">app.post(&#x27;/login&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  // 加入在数据中查询用户名时, 发现不存在</span><br><span class="line">  const isLogin = false;</span><br><span class="line">  if (isLogin) &#123;</span><br><span class="line">    res.json(&quot;user login success~&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // res.type(400);</span><br><span class="line">    // res.json(&quot;username does not exists~&quot;)</span><br><span class="line">    next(new Error(USERNAME_DOES_NOT_EXISTS));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.post(&#x27;/register&#x27;, (req, res, next) =&gt; &#123;</span><br><span class="line">  // 加入在数据中查询用户名时, 发现不存在</span><br><span class="line">  const isExists = true;</span><br><span class="line">  if (!isExists) &#123;</span><br><span class="line">    res.json(&quot;user register success~&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // res.type(400);</span><br><span class="line">    // res.json(&quot;username already exists~&quot;)</span><br><span class="line">    next(new Error(USERNAME_ALREADY_EXISTS));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use((err, req, res, next) =&gt; &#123;</span><br><span class="line">  let status = 400;</span><br><span class="line">  let message = &quot;&quot;;</span><br><span class="line">  console.log(err.message);</span><br><span class="line"></span><br><span class="line">  switch(err.message) &#123;</span><br><span class="line">    case USERNAME_DOES_NOT_EXISTS:</span><br><span class="line">      message = &quot;username does not exists~&quot;;</span><br><span class="line">      break;</span><br><span class="line">    case USERNAME_ALREADY_EXISTS:</span><br><span class="line">      message = &quot;USERNAME_ALREADY_EXISTS~&quot;</span><br><span class="line">      break;</span><br><span class="line">    default: </span><br><span class="line">      message = &quot;NOT FOUND~&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  res.status(status);</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    errCode: status,</span><br><span class="line">    errMessage: message</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;路由服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>更多细节察看expressjs.com.cn</p>
<h4 id="部分原理"><a href="#部分原理" class="headerlink" title="部分原理"></a>部分原理</h4><p>调用express创建的是什么</p>
<p><img src="https://s1.ax1x.com/2022/09/22/xFY0mT.png"></p>
<p>ap.listen如何结合原生启动服务器</p>
<p>listen在createApplication中表面上看不出来，实际上在mixin(app。proto，false)中</p>
<p>调用了原生的http创建服务器启动监听</p>
<p><img src="https://s1.ax1x.com/2022/09/22/xFYytJ.png"></p>
<p>loading……</p>
<p>app.use发生了什么</p>
<p>用户发送网络请求如何执行中间件回调</p>
<p>next为什么会执行下一个中间件</p>
<h3 id="Koa"><a href="#Koa" class="headerlink" title="Koa"></a>Koa</h3><p>koa自称是node.js的下一代框架，koa是和express同一个团队开发的框架</p>
<p>koa旨在为web应用程序和api提供更小，更丰富和强大的能力</p>
<p>相对于express具有更强大的异步处理能力</p>
<p>koa的核心代码只有一千多行，很清凉</p>
<p>我们可以根据需要考虑安装中间件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line">//ctx = context 上下文对象 包含request和response</span><br><span class="line">app.use((ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.response.body = &quot;Hello World&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="注册中间件"><a href="#注册中间件" class="headerlink" title="注册中间件"></a>注册中间件</h4><p>koa并没有提供methods，path和连续注册的方式注册中间件</p>
<p>只能通过app.use(()&#x3D;&gt;{})</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">// use注册中间件</span><br><span class="line">app.use((ctx, next) =&gt; &#123;</span><br><span class="line">  if (ctx.request.url === &#x27;/login&#x27;) &#123;</span><br><span class="line">    if (ctx.request.method === &#x27;GET&#x27;) &#123;</span><br><span class="line">      console.log(&quot;来到了这里~&quot;);</span><br><span class="line">      ctx.response.body = &quot;Login Success~&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    ctx.response.body = &quot;other request~&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 没有提供下面的注册方式</span><br><span class="line">// methods方式: app.get()/.post</span><br><span class="line">// path方式: app.use(&#x27;/home&#x27;, (ctx, next) =&gt; &#123;&#125;)</span><br><span class="line">// 连续注册: app.use((ctx, next) =&gt; &#123;</span><br><span class="line">// &#125;, (ctx, next) =&gt; &#123;</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="路由的使用-1"><a href="#路由的使用-1" class="headerlink" title="路由的使用"></a>路由的使用</h4><p>需要安装第三方库 koa-router</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line"></span><br><span class="line">const userRouter = require(&#x27;./router/user&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use((ctx, next) =&gt; &#123;</span><br><span class="line">  // ctx.response.body = &quot;Hello World&quot;;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(userRouter.routes());</span><br><span class="line">app.use(userRouter.allowedMethods()); //如果访问了错误的地址和方式</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa路由服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//routers</span><br><span class="line">const Router = require(&#x27;koa-router&#x27;);</span><br><span class="line"></span><br><span class="line">const router = new Router(&#123;prefix: &quot;/users&quot;&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.response.body = &quot;User Lists~&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.put(&#x27;/&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.response.body = &quot;put request~&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="参数解析query，params"><a href="#参数解析query，params" class="headerlink" title="参数解析query，params"></a>参数解析query，params</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line">const Router = require(&#x27;koa-router&#x27;);</span><br><span class="line"></span><br><span class="line">const userRouter = new Router(&#123;prefix: &#x27;/users&#x27;&#125;);</span><br><span class="line"></span><br><span class="line">userRouter.get(&#x27;/:id&#x27;, (ctx, next) =&gt; &#123;</span><br><span class="line">  console.log(ctx.request.params);</span><br><span class="line">  console.log(ctx.request.query);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// app.use((ctx, next) =&gt; &#123;</span><br><span class="line">//   console.log(ctx.request.url);</span><br><span class="line">//   console.log(ctx.request.query);</span><br><span class="line">//   console.log(ctx.request.params);</span><br><span class="line">//   ctx.response.body = &quot;Hello World&quot;;</span><br><span class="line">// &#125;);</span><br><span class="line"></span><br><span class="line">app.use(userRouter.routes());</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;参数处理服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="参数解析urlenclded和formdata"><a href="#参数解析urlenclded和formdata" class="headerlink" title="参数解析urlenclded和formdata"></a>参数解析urlenclded和formdata</h4><p>npm install koa-bodyparser koa-multer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line">const bodyParser = require(&#x27;koa-bodyparser&#x27;); //json,urlencoded</span><br><span class="line">const multer = require(&#x27;koa-multer&#x27;); //form-data</span><br><span class="line">const Router = require(&#x27;koa-router&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">const upload = multer();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser());</span><br><span class="line">app.use(upload.any());</span><br><span class="line"></span><br><span class="line">app.use((ctx, next) =&gt; &#123;</span><br><span class="line">  console.log(ctx.request.body);</span><br><span class="line">  console.log(ctx.req.body); //multer塞进去的</span><br><span class="line">  ctx.response.body = &quot;Hello World&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line">const Router = require(&#x27;koa-router&#x27;);</span><br><span class="line">const multer = require(&#x27;koa-multer&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line">const uploadRouter = new Router(&#123;prefix: &#x27;/upload&#x27;&#125;);</span><br><span class="line"></span><br><span class="line">// const storage = multer.diskStorage(&#123;</span><br><span class="line">//   destination,</span><br><span class="line">//   filename,</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line">const upload = multer(&#123;</span><br><span class="line">  dest: &#x27;./uploads/&#x27;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">uploadRouter.post(&#x27;/avatar&#x27;, upload.single(&#x27;avatar&#x27;), (ctx, next) =&gt; &#123;</span><br><span class="line">  console.log(ctx.req.file);</span><br><span class="line">  ctx.response.body = &quot;上传头像成功~&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(uploadRouter.routes());</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="koa响应内容"><a href="#koa响应内容" class="headerlink" title="koa响应内容"></a>koa响应内容</h4><p>body将相应主体分为</p>
<p>string</p>
<p>Buffer</p>
<p>Stream</p>
<p>Object&#x2F;Array</p>
<p>null</p>
<p>如果response.status未设置，koa自动设置状态为200或者204  &#x2F;&#x2F;有内容200，没内容返回null和204</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use((ctx, next) =&gt; &#123;</span><br><span class="line">  // ctx.request.query</span><br><span class="line">  // ctx.query</span><br><span class="line"></span><br><span class="line">  // 设置内容</span><br><span class="line">  // ctx.response.body</span><br><span class="line">  // ctx.response.body = &quot;Hello world~&quot;</span><br><span class="line">  // ctx.response.body = &#123;</span><br><span class="line">  //   name: &quot;coderwhy&quot;,</span><br><span class="line">  //   age: 18,</span><br><span class="line">  //   avatar_url: &quot;https://abc.png&quot;</span><br><span class="line">  // &#125;;</span><br><span class="line">  // 设置状态码</span><br><span class="line">  // ctx.response.status = 400;</span><br><span class="line">  // ctx.response.body = [&quot;abc&quot;, &quot;cba&quot;, &quot;nba&quot;];</span><br><span class="line"></span><br><span class="line">  // ctx.response.body = &quot;Hello World~&quot;;</span><br><span class="line">  ctx.status = 404;</span><br><span class="line">  ctx.body = &quot;Hello Koa~&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="部署静态资源"><a href="#部署静态资源" class="headerlink" title="部署静态资源"></a>部署静态资源</h4><p>npm Install koa-static</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line">const staticAssets = require(&#x27;koa-static&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use(staticAssets(&#x27;./build&#x27;));</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use((ctx, next) =&gt; &#123;</span><br><span class="line">  const isLogin = false;</span><br><span class="line">  if (!isLogin) &#123;</span><br><span class="line">    ctx.app.emit(&#x27;error&#x27;, new Error(&quot;您还没有登录~&quot;), ctx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.on(&#x27;error&#x27;, (err, ctx) =&gt; &#123;</span><br><span class="line">  ctx.status = 401;</span><br><span class="line">  ctx.body = err.message;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;koa初体验服务器启动成功~&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="express和koa的区别"><a href="#express和koa的区别" class="headerlink" title="express和koa的区别"></a>express和koa的区别</h3><p>express比较完整，koa比较自由简洁只包含核心功能，我们需要自己安装使用</p>
<p>两者核心都是中间件</p>
<h4 id="express同步数据"><a href="#express同步数据" class="headerlink" title="express同步数据"></a>express同步数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">const middleware1 = (req, res, next) =&gt; &#123;</span><br><span class="line">  req.message = &quot;aaa&quot;;</span><br><span class="line">  next();</span><br><span class="line">  res.end(req.message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware2 = (req, res, next) =&gt; &#123;</span><br><span class="line">  req.message += &quot;bbb&quot;;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware3 = (req, res, next) =&gt; &#123;</span><br><span class="line">  req.message += &quot;ccc&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(middleware1, middleware2, middleware3);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;服务器启动成功~&quot;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="express异步数据"><a href="#express异步数据" class="headerlink" title="express异步数据"></a>express异步数据</h4><p>express处理异步数据非常麻烦，只能单独抽离函数await</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const axios = require(&#x27;axios&#x27;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">const middleware1 = async (req, res, next) =&gt; &#123;</span><br><span class="line">  req.message = &quot;aaa&quot;;</span><br><span class="line">  await next();</span><br><span class="line">  res.end(req.message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware2 = async (req, res, next) =&gt; &#123;</span><br><span class="line">  req.message += &quot;bbb&quot;;</span><br><span class="line">  await next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware3 = async (req, res, next) =&gt; &#123;</span><br><span class="line">  const result = await axios.get(&#x27;http://123.207.32.32:9001/lyric?id=167876&#x27;);</span><br><span class="line">  req.message += result.data.lrc.lyric;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(middleware1, middleware2, middleware3);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;服务器启动成功~&quot;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="koa同步数据"><a href="#koa同步数据" class="headerlink" title="koa同步数据"></a>koa同步数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">const middleware1 = (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.message = &quot;aaa&quot;;</span><br><span class="line">  next();</span><br><span class="line">  ctx.body = ctx.message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware2 = (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.message += &quot;bbb&quot;;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware3 = (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.message += &quot;ccc&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(middleware1);</span><br><span class="line">app.use(middleware2);</span><br><span class="line">app.use(middleware3);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;服务器启动成功~&quot;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="koa异步数据"><a href="#koa异步数据" class="headerlink" title="koa异步数据"></a>koa异步数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line">const axios = require(&#x27;axios&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">const middleware1 = async (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.message = &quot;aaa&quot;;</span><br><span class="line">  await next();</span><br><span class="line">  next();</span><br><span class="line">  ctx.body = ctx.message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware2 = async (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.message += &quot;bbb&quot;;</span><br><span class="line">  await next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const middleware3 = async (ctx, next) =&gt; &#123;</span><br><span class="line">  const result = await axios.get(&#x27;http://123.207.32.32:9001/lyric?id=167876&#x27;);</span><br><span class="line">  ctx.message += result.data.lrc.lyric;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(middleware1);</span><br><span class="line">app.use(middleware2);</span><br><span class="line">app.use(middleware3);</span><br><span class="line"></span><br><span class="line">app.listen(8000, () =&gt; &#123;</span><br><span class="line">  console.log(&quot;服务器启动成功~&quot;);</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<h3 id="洋葱模型"><a href="#洋葱模型" class="headerlink" title="洋葱模型"></a>洋葱模型</h3><p>……</p>
<p>学无止境，结束意味着新的开始</p>
<p>loading……</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://222cabbage.github.io/2022/06/04/Node6/" title="http内置模块，Express和Koa" target="_blank" rel="external">https://222cabbage.github.io/2022/06/04/Node6/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/222cabbage" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/222cabbage" target="_blank"><span class="text-dark">222cabbage</span><small class="ml-1x">我是小白菜</small></a></h3>
        <div>菜，但是努力</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2022/06/12/websocket1/" title="websocket学习"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2022/05/30/Node5/" title="Buffer和浏览器的事件循环"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>
  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/222cabbage" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2022 不知名小白菜
        
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: true,
    appId: 'wf68R2QC2QUAaKIBwhTLoM1v-gzGzoHsz',
    appKey: 'OybYvwmLu9b7LKSt6kySuFkw',
    placeholder: '快来留言吧嘻嘻嘻',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>